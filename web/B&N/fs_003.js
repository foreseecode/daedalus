/***************************************
* @preserve
* ForeSee Web SDK: record
* Built September 17, 18 10:24:27
* Code version: 19.7.2
* Template version: 19.7.2
***************************************/
_fsDefine(["require","fs",_fsNormalizeUrl("$fs.utils.js"),"recordconfig"],function(e,fs,utils,h){var s={},l=window,d="fs_sessionStarted",t="fs_recorderCanceled",u="fs_recorderStoppedOldBrowser",f="rpid",g="mid",p="rt",m="cncl",v="SESSION",y="grft",_="norec",a=function(){function e(){this.elIndex=new Map,this.idIndex=new Map,this.idEl=new Map,this.root=null,this.nextId=1}return e.prototype.scan=function(e){var t,i,s=[],n={id:0,p:0,t:e.nodeType,c:s};for(null==this.root&&(this.root=n),t=0,i=e.childNodes.length;t<i;t++)this.get(e.childNodes[t])||s.push(this.scan(e.childNodes[t]));if(this._track(e,n),null!=e.nodeValue&&(n.v=e.nodeValue),"#"!==e.nodeName[0]){if(n.n=e.nodeName,e.hasAttributes&&e.hasAttributes())for(n.a={},t=0,i=e.attributes.length;t<i;t++)n.a[e.attributes[t].name]=e.attributes[t].value;10===e.nodeType&&(n.publicId&&(n.publicId=e.publicId),n.systemId&&(n.systemId=e.systemId))}for(t=0,i=s.length;t<i;t++)s[t].p=n.id;return n},e.prototype.import=function(e){var t,i;for(null==this.root&&(this.root=e),t=0,i=e.c.length;t<i;t++)this.import(e.c[t]);return this.idIndex.set(e.id,e),e},e.prototype.add=function(e,t){var i,s,n=this.get(e);return s=Array.prototype.indexOf.call(e.childNodes,t),i=this.scan(t),n.c.splice(s,0,i),i.p=n.id,i},e.prototype.insert=function(e,t){var i=this.getById(t.p);return this.import(t),i.c.splice(e,0,t),t},e.prototype.move=function(e,t,i,s){var n,r=this.get(e),o=this.getById(r.p),a=this.get(t);o.c.splice(o.c.indexOf(r),1),r.p=a.id,i?s?a.c.splice(a.c.indexOf(this.get(s)),0,r):((n=a.c.indexOf(this.get(i))+1)>a.c.length&&(n=a.c.length),n<0&&(n=0),a.c.splice(n,0,r)):s&&this.get(s)===a.c[0]?a.c.unshift(r):((n=a.c.indexOf(this.get(s)))>a.c.length&&(n=a.c.length),n<0&&(n=0),a.c.splice(n,0,r))},e.prototype.moveById=function(e,t,i){var s=this.getById(e),n=this.getById(s.p),r=this.getById(t);n.c.splice(n.c.indexOf(s),1),r.c.splice(i,0,s),s.p=r.id},e.prototype.get=function(e){return this.elIndex.get(e)},e.prototype.getById=function(e){return this.idIndex.get(e)},e.prototype.remove=function(e){var t,i,s=this.get(e);for(t=s.c.length-1;0<=t;t--)this.remove(this.idEl.get(s.c[t].id));return this.elIndex.delete(e),this.idIndex.delete(s.id),this.idEl.delete(s.id),0<s.p&&(i=this.getById(s.p)).c.splice(i.c.indexOf(s),1),s},e.prototype.removeById=function(e){var t,i=this.getById(e),s=this.getById(i.p);for(t=i.c.length-1;0<=t;t--)this.removeById(i.c[t].id);return this.idIndex.delete(e),s&&s.c.splice(s.c.indexOf(i),1),i},e.prototype._track=function(e,t){var i=this.nextId;return this.nextId++,t.id=i,this.elIndex.set(e,t),this.idIndex.set(i,t),this.idEl.set(i,e),i},e.prototype.dispose=function(){this.elIndex.clear(),this.idIndex.clear(),this.idEl.clear(),this.nextId=1,this.root=null},e},b=a();function E(e,t,i){this.dom=e,this.tree=t,this.modifier=i,this.roots=new Set,this.checked=new Set}E.prototype.reset=function(){this.roots.clear(),this.checked.clear()},E.prototype.dispose=function(){this.reset(),this.dom=null,this.tree=null},E.prototype.addChangedEl=function(e){this.roots.add(e)},E.prototype.checkAll=function(){return this.reset(),this.roots.add(this.dom),this.check()},E.prototype.check=function(){var i=!0;return this.roots.forEach(function(e){var t=this.tree.get(e);t&&!this._checkEl(e,t)&&(i=!1)}.bind(this)),i},E.prototype._checkEl=function(e,t){if(this.checked.has(e))return!0;this.checked.add(e);var i=!0;return this.tree.get(e)!==t&&(console.error("Node mismatch",t,e),i=!1),t.t!==e.nodeType&&(console.error("Name mismatch at node",t,e),i=!1),t.n&&t.n!==e.nodeName&&(console.error("Name mismatch at node",t,e),i=!1),t.v&&t.v!==e.nodeValue&&(console.error("Value mismatch at node",t,e),i=!1),this._syncChildren(e,e.childNodes,t.c)||(i=!1),i},E.prototype._syncChildren=function(e,t,i){for(var s,n,r=!0,o=t.length,a=i.length,c=Math.min(o,a),h=0,d=o-1,l=a-1;h<c&&this.tree.get(t[h])===i[h];h++)this._checkEl(t[h],i[h])||(r=!1);for(;h<=d&&h<=l&&this.tree.get(t[d])===i[l];d--,l--)this._checkEl(t[d],i[l])||(r=!1);if(l++,++d<=h&&l<=h)return r;if(h<d&&l<=h){for(;h<d;h++)s=this.tree.add(e,t[h]),this.modifier.add(t[h],s,h);return!1}if(h<l&&d<=h){for(;h<l;l--)n=this.tree.idEl.get(i[h].id),s=this.tree.remove(n),this.modifier.remove(n,s);return!1}for(var u=h;u<l;u++)n=this.tree.idEl.get(i[h].id),s=this.tree.remove(n),this.modifier.remove(n,s);for(;h<d;h++)s=this.tree.add(e,t[h]),this.modifier.add(t[h],s,h);return!1};var w=function(e,t,i,s){fs.ext(this,{rec:i,masker:e,worker:t,tree:s,_inputsTracked:[],_inputValues:[],_inputCaretInfo:[]},!1)};w.prototype.scanForInputs=function(e){var t,i,s=this._inputsTracked,n=function(e){return-1==s.indexOf(e)};for(t=0;t<e.length;t++)i=e[t].querySelectorAll("input, textarea, select"),Array.prototype.filter.call(i,n).forEach(this._watchInput.bind(this))},w.prototype._updateKnownValue=function(e,t){var i=this._inputValues,s=function(e,t){for(var i=e.length,s=0;s<i;){if(e[s].ipt===t)return e[s];s++}return null}(i||[],e);return s?s.v!=t&&(s.v=t,!0):(i.push({ipt:e,v:t}),!0)},w.prototype._getPreviousValue=function(e){var t=function(e,t){for(var i=e.length,s=0;s<i;){if(e[s].ipt===t)return e[s];s++}return null}(this._inputValues||[],e);return t&&t.v||""},w.prototype._watchInput=function(e){var t=(e.getAttribute("type")||"").toUpperCase(),i=e.tagName;this._inputsTracked.push(e),"TEXTAREA"==i||"INPUT"==i&&-1<"EMAIL,PASSWORD,TEXT,COLOR,DATE,DATETIME-LOCAL,MONTH,NUMBER,RANGE,SEARCH,TEL,TIME,URL,WEEK".indexOf(t)?(this.rec.bind(e,"focus",function(e){var t=e.target||e.srcElement;this.worker.queueAction(M.FOCUS_BLUR,{ctx:this.rec.getPath(),id:this.tree.get(t).id,v:!0}),this._serializeInput(t),this._logCaretInfo(t,!0)}.bind(this)),this.rec.bind(e,"blur",function(e){var t=e.target||e.srcElement;this.worker.queueAction(M.FOCUS_BLUR,{ctx:this.rec.getPath(),id:this.tree.get(t).id,v:!1}),this._serializeInput(t)}.bind(this)),this.rec.bind(e,"select",function(e){var t=e.target||e.srcElement;this._logCaretInfo(t)}.bind(this)),this.rec.bind(e,"input",function(e){var t=e.target||e.srcElement,i=t.value||"",s=this._getPreviousValue(t)||"";this.worker.queueAction(M.KEY_PRESS,{ctx:this.rec.getPath(),id:this.tree.get(t).id,v0:s,v1:i}),this._updateKnownValue(t,i),this._logElScroll(t)}.bind(this)),this.rec.bind(e,"keyup",function(e){var t=e.target||e.srcElement,i=utils.getKeyCode(e);-1==[16,91,18,27,17,93,18,20].indexOf(i)&&this._logCaretInfo(t)}.bind(this)),this._listenToJavascriptCausedChanges(e)):"SELECT"==i?(this.rec.bind(e,"change",function(e){var t=e.target||e.srcElement;this._serializeInput(t)}.bind(this)),this.rec.bind(e,"blur",function(e){var t=e.target||e.srcElement;this._serializeInput(t)}.bind(this))):"INPUT"==i&&-1<"CHECKBOX,RADIO".indexOf(t)&&this.rec.bind(e,"change",function(e){var t=e.target||e.srcElement;this._serializeInput(t)}.bind(this))},w.prototype._serializeInput=function(t){var e,i,s,n=(t.getAttribute("type")||"TEXT").toUpperCase(),r=t.tagName;if("TEXTAREA"===r||"INPUT"==r&&-1=="CHECKBOX,RADIO".indexOf(n))e=t.value||"",this._updateKnownValue(t,e)&&(i=this._getCaretInfo(t),s={ctx:this.rec.getPath(),id:this.tree.get(t).id,v:e,t:n,n:r},i&&(s.cs=i.s,s.ce=i.e),this.worker.queueAction(M.INPUT_SERIALIZE,s));else if("SELECT"===r){e=t.selectedIndex;var o=null!==t.getAttribute("multiple");if(o&&(e=Array.prototype.map.call(t.selectedOptions,function(e){return Array.prototype.indexOf.call(t.options,e)})),this._updateKnownValue(t,"number"==typeof e?e:e.join(","))){var a={ctx:this.rec.getPath(),id:this.tree.get(t).id,t:n,n:r,m:o};o?a.so=e:a.s=e,this.worker.queueAction(M.INPUT_SERIALIZE,a)}}else"INPUT"===r&&(e=t.checked,this._updateKnownValue(t,e)&&this.worker.queueAction(M.INPUT_SERIALIZE,{ctx:this.rec.getPath(),id:this.tree.get(t).id,ch:e,t:n,n:r}))};var i="text|search|password|tel|url".split("|");w.prototype._getCaretInfo=function(e){return"input"===e.tagName.toLowerCase()&&i.indexOf(e.type.toLowerCase())<0?null:e&&null!=e.selectionStart?{s:e.selectionStart,e:e.selectionEnd}:void 0},w.prototype._logCaretInfo=function(t,e){var i=this._getCaretInfo(t),s=this._inputCaretInfo.find(function(e){return e.ipt===t});i&&(!e&&s&&s.s===i.s&&s.e===i.e||(s||(s={ipt:t},this._inputCaretInfo.push(s)),this.worker.queueAction(M.CARET_INFO,{ctx:this.rec.getPath(),id:this.tree.get(t).id,s:i.s,e:i.e}),s.s=i.s,s.e=i.e,this._logElScroll(t)))},w.prototype._logElScroll=function(t){var e=this._inputCaretInfo.find(function(e){return e.ipt===t});e||(e={ipt:t},this._inputCaretInfo.push(e));var i=Math.round(t.scrollLeft),s=Math.round(t.scrollTop);e.sx===i&&e.sy===s||(e.sx=i,e.sy=s,this.worker.queueAction(M.SCROLL_EL,{ctx:this.rec.getPath(),id:this.tree.get(t).id,x:e.sx,y:e.sy}))},w.prototype._stopWatchingInput=function(t){utils.Unbind(t),this._inputsTracked.splice(this._inputsTracked.indexOf(t),1),this._inputValues.splice(this._inputValues.find(function(e){return e.ipt===t}),1),this._inputCaretInfo.splice(this._inputCaretInfo.find(function(e){return e.ipt===t}),1)},w.prototype._listenToJavascriptCausedChanges=function(e){},w.prototype.untrackInputs=function(e){var t,i=this._inputsTracked;for(t=0;t<i.length;t++)1===e.nodeType&&e.contains(i[t])&&this._stopWatchingInput(i[t])},w.prototype.dispose=function(){this._inputsTracked.forEach(function(e){this._stopWatchingInput(e)}.bind(this)),delete this.masker,delete this._inputsTracked};var S=function(t,e,i,s){fs.ext(this,{throttleTime:i,recFunction:s,subject:t,lastCap:utils.now()},!1),utils.Bind(t,e,function(e){this._capture&&this._capture(e,t)}.bind(this))};S.prototype.merge=function(t,e,i){return utils.Bind(t,e,function(e){this._capture&&this._capture(e,t,i)}.bind(this)),this},S.prototype._capture=function(e,t,i){var s,n;clearTimeout(this.lastCapThrottle),this._eventCopy=fs.ext({},e,!1),utils.now()-this.lastCap>this.throttleTime?(this.recFunction(e,t,i),this.lastCap=utils.now()):(this.capCB=(s=this._eventCopy,n=t,fs.isDefined(s.clientX)&&(s.sX=s.clientX,s.sY=s.clientY),function(){this.capCB=null,s.delayed=!0,this.recFunction(s,n,i),this.lastCap=utils.now()}).bind(this),this.lastCapThrottle=setTimeout(this.capCB,this.throttleTime-(utils.now()-this.lastCap)))},S.prototype.trigger=function(){this.capCB&&(clearTimeout(this.lastCapThrottle),this.capCB())};S.prototype.dispose=function(){clearTimeout(this.lastCapThrottle),fs.dispose(this)};var I=function(e,t,i,s,n,r,o,a,c){var h;if(fs.ext(this,{fr:e,config:t,masker:i,worker:s,newInfoScanner:n,inputCap:o,ctx:r,urlmd5:a,tree:c},!1),"MutationObserver"!==(h=void 0!==window.__zone_symbol__MutationObserver?window.__zone_symbol__MutationObserver:"undefined"!=typeof WebKitMutationObserver?WebKitMutationObserver:MutationObserver).name){var d=new h(function(){});d.__zone_symbol__originalInstance?h=d.__zone_symbol__originalInstance.constructor:d._zone$originalInstance&&(h=d._zone$originalInstance.constructor)}this.ob=new h(this._handleMutation.bind(this)),this.ob.observe(e.document.documentElement,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!1})};I.prototype._handleMutation=function(e){var t,i,s,n,r,o,a,c,h,d,l,u=0,p=[],f=this.worker,g=this.masker,m=[],v=this.tree,y=new Map,_=new Map,b=new E(this.fr.document.documentElement,v,{add:function(e,t,i){0,this._addElement(p,m,e,t,i)}.bind(this),remove:function(e,t){0,this._removeElement(p,e,t)}.bind(this)});for(d=g.piiObj.noRules?function(){return 0}:function(e,t){return e=e||0,1===t.nodeType&&"SCRIPT"!=t.tagName&&"LINK"!=t.tagName&&"IFRAME"!=t.tagName?e+1:e+0},i=0;i<e.length;i++)if(0<(t=e[i]).addedNodes.length?u=Array.prototype.reduce.call(t.addedNodes,d,u):"attributes"===t.type&&"class"===t.attributeName&&u++,"childList"===t.type&&v.get(t.target)){for(s=0;s<t.removedNodes.length;s++)v.get(t.removedNodes[s])&&y.set(t.removedNodes[s],t.target);for(s=0;s<t.addedNodes.length;s++)n=t.addedNodes[s],y.has(n)&&(_.set(n,(_.get(n)||[]).concat({from:y.get(n),to:t.target})),y.delete(n))}for(0<u&&(h=g.updateMaskingTargets()),i=0;i<e.length;i++)if(n=(t=e[i]).target,r=v.get(n),"attributes"==t.type){if(!r)continue;if(r.a=r.a||{},(l=n.getAttribute(t.attributeName))===r.a[t.attributeName])continue;r.a[t.attributeName]=l,p.push({e:M.ATTR_MODIFIED,d:{ctx:this.ctx,id:r.id,attr:t.attributeName,val:r.a[t.attributeName],tn:r.n,r:r.a.rel||0}})}else if("characterData"==t.type){if(!r)continue;r.v=n.nodeValue,p.push({e:M.CHAR_DATA,d:{ctx:this.ctx,id:r.id,v:n.nodeValue}})}else{if("childList"!=t.type)throw new Error("Unknown type: "+t.type);for(b.addChangedEl(n),u=0;u<t.removedNodes.length;u++)o=t.removedNodes[u],_.has(o)&&v.get(o)||v.get(o)&&(r=this.tree.remove(o),this._removeElement(p,o,r));for(u=0;u<t.addedNodes.length;u++)if(o=t.addedNodes[u],a=v.get(o),c=v.get(n))if(a&&_.has(o)){_.has(o)&&(_.get(o).shift(),_.get(o).length<1&&_.delete(o));var w=v.getById(a.p);if(c.id===a.p&&Array.prototype.indexOf.call(n,o)===w.c.indexOf(a))continue;w.c.indexOf(a);v.move(o,n,t.previousSibling,t.nextSibling),p.push({e:M.NODE_MOVED,d:{ctx:this.ctx,id:a.id,p:c.id,idx:c.c.indexOf(a)}})}else{if(a||!this.fr.document.documentElement.contains(o)||!o.parentNode||!v.get(o.parentNode))continue;a=v.add(o.parentNode,o),c=v.getById(a.p),this._addElement(p,m,o,a,c.c.indexOf(a))}}b.check(),h&&h.hasChanges&&I.markTreeMaskingChanges(v,h,this.ctx,p),0<p.length&&f.queueAction(M.MOD_LIST,p),0<m.length&&this.newInfoScanner(m)},I.prototype._removeElement=function(e,t,i){this.masker.removeNodeFromMaskingTargets(t),this.inputCap.untrackInputs(t),e.push({e:M.NODE_REMOVED,d:{ctx:this.ctx,id:i.id}})},I.prototype._addElement=function(e,t,i,s,n){e.push({e:M.NODE_ADDED,d:{ctx:this.ctx,tree:JSON.parse(JSON.stringify(s)),idx:n}}),1===i.nodeType&&-1==t.indexOf(i)&&t.push(i)},I.markTreeMaskingChanges=function(e,t,i,s){var n,r,o,a;for(n in t)for(o=t[n],r=0;r<o.length;r++)(a=e.get(o[r]))[n]=!0,s.push({e:M.NODE_REMOVED,d:{ctx:i,id:a.id}}),s.push({e:M.NODE_ADDED,d:{ctx:i,tree:JSON.parse(JSON.stringify(a)),idx:e.getById(a.p).c.indexOf(a)}})},I.prototype.dispose=function(){this.ob.disconnect(),this.fr=null,this.newInfoScanner=null};var T={getParentWindow:function(e){var t=e;if(e){if(e._pw)return e._pw;if(e.ownerDocument&&e.ownerDocument.defaultView)return e.ownerDocument.defaultView;for(;e.parentNode||e.document;){if(e.document)return t._pw=e;e=e.parentNode}}},getDocType:function(e,t){var i,s="",n=t.doctype,r=t.childNodes,o=0;if(e.isIE&&("CSS1Compat"!=t.compatMode||5==t.documentMode))return s;if(n){try{if((i=(new XMLSerializer).serializeToString(n).toString())&&0<i.length)return i}catch(e){}s="<!DOCTYPE HTML",n.publicId&&(s=s+' PUBLIC "'+n.publicId+'"'),n.systemId&&(s=s+' SYSTEM "'+n.systemId+'"'),s+=">"}else if(r[o].text){for(;r[o].text&&(0===r[o].text.indexOf("\x3c!--")||0===r[o].text.indexOf("<?xml"));)o++;fs.isDefined(r[o].text)&&0===fs.toLowerCase(r[o].text).indexOf("<!doctype")&&(s=r[o].text)}return s},getStyle:function(e,t,i){if(!t)return"";var s="",n=t.document.defaultView;return n&&n.getComputedStyle&&n.getComputedStyle(e,"")?s=n.getComputedStyle(e,"").getPropertyValue(i):e.currentStyle&&(i=i.replace(/\-(\w)/g,function(e,t){return t.toUpperCase()}),s=e.currentStyle[i]),s},getPosition:function(e,t){for(var i=0,s=0,n=T.getStyle;e;)i+=e.offsetTop+(parseFloat(n(e,t,"borderTopWidth"))||0),s+=e.offsetLeft+(parseFloat(n(e,t,"borderLeftWidth"))||0),e=e.offsetParent;return{x:s,y:i}},getPositionRelativeToMainView:function(e,t,i){for(var s,n=!1;!n&&t;){n=t.parent==t;var r=T.getPosition(e,t),o=utils.getScroll(t);i&&!n&&(r.x-=o.x,r.y-=o.y),s?(s.x+=r.x,s.y+=r.y):s=r,e=t.frameElement,t=t.parent}return s},getDocSize:function(e){var t=e||window.document,i=t.body,s=t.documentElement,n=Math.max;return{width:n(n(i.scrollWidth,s.scrollWidth),n(i.offsetWidth,s.offsetWidth),n(i.clientWidth,s.clientWidth)),height:n(n(i.scrollHeight,s.scrollHeight),n(i.offsetHeight,s.offsetHeight),n(i.clientHeight,s.clientHeight))}},getVisualViewportPosition:function(e){return e.visualViewport?{left:e.visualViewport.pageLeft,top:e.visualViewport.pageTop,width:e.visualViewport.width,height:e.visualViewport.height}:{left:e.pageXOffset,top:e.pageYOffset,width:e.innerWidth,height:e.innerHeight}},getViewportSizePos:function(e){var t=T.getVisualViewportPosition(e),i=T.getDocSize(e.document),s=e.document.documentElement,n=s.clientWidth,r=s.clientHeight;function o(e){return Math.round(1e3*e)/1e3}return{pw:o(i.width),ph:o(i.height),lw:o(n),lh:o(r),vw:o(t.width),vh:o(t.height),vx:o(t.left),vy:o(t.top)}},externalizeStyleCSSTextToInnerHTML:function(e){var t,i,s=!1;if(fs.isDefined(h.useCSSText)||((t=document.createElement("style")).setAttribute("type","text/css"),h.useCSSText=fs.isDefined(t.styleSheet)),h.useCSSText)for(var n=0,r=(t="STYLE"==e.nodeName?[e]:e.querySelectorAll("style")).length;n<r;n++)(i=t[n]).styleSheet&&i.styleSheet.cssText&&i.styleSheet.cssText.replace(/\s/gi,"").length!=i.innerHTML.replace(/\s/gi,"").length&&(i.innerHTML=i.styleSheet.cssText,s=!0);return s}},k=function(e,t){this.win=t,this.doc=t.document,this.piiObj=this._prepPIIObjectForPage(e,t),this.maskEls={whiteList:[],block:[],obscure:[],ignore:[],inputWhiteList:[],useWhiteListing:!0}};k.prototype._prepPIIObjectForPage=function(e,t){var i,s=JSON.parse(JSON.stringify(e)),n=fs.toLowerCase(fs.getParam("fsrurl")||t.location.href||"about:blank"),r=!0,o=!1;for(s.staticBlockEls&&(s.selectiveMaskZones=fs.ext(s.selectiveMaskZones||{},s.staticBlockEls),delete s.staticBlockEls,o=!0),s.dynamicBlockEls&&(s.selectiveMaskZones=fs.ext(s.selectiveMaskZones||{},s.dynamicBlockEls),delete s.dynamicBlockEls,o=!0),s.selectiveMaskZones=s.selectiveMaskZones||{},s.staticVisibleEls&&(s.selectiveUnMaskZones=fs.ext(s.selectiveUnMaskZones||{},s.staticVisibleEls),s.visibleInputs=fs.ext(s.visibleInputs||{},s.staticVisibleEls),delete s.staticVisibleEls,o=!0),s.dynamicVisibleEls&&(s.selectiveUnMaskZones=fs.ext(s.selectiveUnMaskZones||{},s.dynamicVisibleEls),s.visibleInputs=fs.ext(s.visibleInputs||{},s.dynamicVisibleEls),delete s.dynamicVisibleEls,o=!0),s.staticWhiteListEls&&(s.selectiveUnMaskZones=fs.ext(s.selectiveUnMaskZones||{},s.staticWhiteListEls),s.visibleInputs=fs.ext(s.visibleInputs||{},s.staticWhiteListEls),delete s.staticWhiteListEls,o=!0),s.dynamicWhiteListEls&&(s.selectiveUnMaskZones=fs.ext(s.selectiveUnMaskZones||{},s.dynamicWhiteListEls),s.visibleInputs=fs.ext(s.visibleInputs||{},s.dynamicWhiteListEls),delete s.dynamicWhiteListEls,o=!0),s.selectiveUnMaskZones=s.selectiveUnMaskZones||{},s.removeVisibilityEls&&(s.redactZones=fs.ext(s.redactZones||{},s.removeVisibilityEls),delete s.removeVisibilityEls,o=!0),s.obscureEls&&(s.redactZones=fs.ext(s.redactZones||{},s.obscureEls),delete s.obscureEls,o=!0),s.assetBlockEls&&(s.redactZones=fs.ext(s.redactZones||{},s.assetBlockEls),delete s.assetBlockEls,o=!0),s.redactZones=s.redactZones||{},null==s.pagesToSelectiveMask&&(s.pagesToSelectiveMask=[],o&&0===Object.keys(s.selectiveUnMaskZones).length&&(s.pagesToSelectiveMask=Object.keys(s.selectiveMaskZones))),o&&console.warn("sr: upgraded config to: pii:",JSON.stringify(s,null,2),"\n(to make this message disappear, please upgrade to new record config format)"),i=0;i<s.pagesToSelectiveMask.length;i++)if(utils.testAgainstSearch(s.pagesToSelectiveMask[i],n)){r=!1;break}function a(e,t,i){var s,n=e[t],r=Object.keys(n||{}),o=[];for(s=0;s<r.length;s++)utils.testAgainstSearch(r[s]||"*",i)?o.push(n[r[s]]):delete n[r[s]];return e[t]=o.join(",").trim(),0==o.length&&(delete e[t],!0)}return s.useWhiteListing=r,delete s.pagesToSelectiveMask,r?(delete s.selectiveMaskZones,s.noRules=a(s,"selectiveUnMaskZones",n)):(s.noRules=a(s,"selectiveMaskZones",n),delete s.selectiveUnMaskZones),a(s,"visibleInputs",n),a(s,"redactZones",n),s},k.prototype.removeNodeFromMaskingTargets=function(e){var t,i=this.piiObj,s=this.maskEls,n=s.whiteList,r=s.block,o=(s.obscure,s.inputWhiteList);if(i.useWhiteListing&&0<n.length)for(t=n.length-1;0<=t;t--)(e===n[t]||1===e.nodeType&&e.contains(n[t]))&&n.splice(t,1);else if(!i.useWhiteListing&&0<r.length)for(t=r.length-1;0<=t;t--)(e===r[t]||1===e.nodeType&&e.contains(r[t]))&&r.splice(t,1);for(t=o.length-1;0<=t;t--)(e===o[t]||1===e.nodeType&&e.contains(o[t]))&&o.splice(t,1)},k.prototype.getCurrentMaskingTargets=function(){var e=this.maskEls;return{unmasked:e.whiteList,masked:e.block,whitelist:e.inputWhiteList,redact:e.obscure}},k.prototype.updateMaskingTargets=function(){var e,t,i,s,n,r,o,a=this.piiObj,c=this.doc,h=this.maskEls,d=h.whiteList,l=h.block,u=h.obscure,p=h.ignore,f=h.inputWhiteList,g=!1,m={unmasked:[],masked:[],whitelist:[],redact:[]};if(!a.noRules)if(a.useWhiteListing){if(a.selectiveUnMaskZones&&(e=c.querySelectorAll(a.selectiveUnMaskZones),0<(t=Array.prototype.filter.call(e,function(e){return-1==d.indexOf(e)&&-1==p.indexOf(e)})).length))for(n=0,i=t.length;n<i;n++){for(s=t[n],o=!1,r=d.length-1;0<=r;r--)if(1===d[r].nodeType&&d[r].contains(s)){p.push(s),o=!0;break}o||(d.push(s),m.unmasked.push(s),g=!0)}}else if(a.selectiveMaskZones&&(e=c.querySelectorAll(a.selectiveMaskZones),0<(t=Array.prototype.filter.call(e,function(e){return-1==l.indexOf(e)&&-1==p.indexOf(e)})).length))for(n=0,i=t.length;n<i;n++){for(s=t[n],o=!1,r=l.length-1;0<=r;r--)if(1===l[r].nodeType&&l[r].contains(s)){p.push(s),o=!0;break}o||(l.push(s),m.masked.push(s),g=!0)}if(a.visibleInputs&&(e=c.querySelectorAll("input, select, textarea")||[],0<(t=Array.prototype.filter.call(e,function(e){var t=!1;return void 0!==e.matches?t=e.matches(a.visibleInputs):void 0!==e.msMatchesSelector?t=e.msMatchesSelector(a.visibleInputs):void 0!==e.matchesSelector&&(t=e.matchesSelector(a.visibleInputs)),t&&-1==f.indexOf(e)})).length))for(n=t.length-1;0<=n;n--)s=t[n],f.push(s),m.whitelist.push(s),g=!0;if(a.redactZones&&(e=c.querySelectorAll(a.redactZones),0<(t=Array.prototype.filter.call(e,function(e){return-1==u.indexOf(e)})).length))for(n=t.length-1;0<=n;n--)s=t[n],u.push(s),m.redact.push(s),g=!0;return m.hasChanges=g,m},k.prototype.dispose=function(){delete this.win,delete this.doc,delete this.piiObj};var x=function(e,t,i,s,n,r,o,a,c,h,d,l){var u,p,f;if(fs.ext(this,{config:t,masker:r,worker:o,browser:e,rec:a,urlmd5:h,recTop:a.getTop(),ctx:c||0,isXDRIFrameMode:i,isTop:s,fr:n,_framesBeingTracked:[],isMousedOverPage:!0,lastOrientation:{alpha:0,beta:0,gamma:0},lastSizes:{},sessionInfo:l,tree:d||new b},!1),this.tree.scan(n.document.documentElement),this.inputCap=new w(r,o,a,this.tree),I.markTreeMaskingChanges(this.tree,r.getCurrentMaskingTargets(),this.ctx,[]),this._serializeDom(),this.mutation=new I(n,t,r,o,function(e){this.inputCap.scanForInputs(e),this.scanForIframes(e)}.bind(this),c,this.inputCap,h,this.tree),this.inputCap.scanForInputs([n.document.body]),s){var g=this._getHiddenKeys();this.rec.bind(window,g.visibilityChange,function(e){this.worker.queueAction(M.PAGE_VISIBLE,{ctx:0,v:!document[g.hidden]})}.bind(this)),this.rec.bind(a.win.document,"mouseout",function(e){if(this.isMousedOverPage){var t=e.relatedTarget||e.toElement,i=(this.recTop,this.mouseMoveCapture);!i||t&&"HTML"!==t.nodeName||(i.trigger(),this.isMousedOverPage=!1,this.worker.queueAction(M.WINDOW_MOUSEOUT_MOUSEENTER,{ctx:0,v:!1}),this.worker.emergency())}}.bind(this)),this.rec.bind(a.win.document,"mouseenter",function(e){this.isMousedOverPage||(this.isMousedOverPage=!0,this.worker.queueAction(M.WINDOW_MOUSEOUT_MOUSEENTER,{ctx:0,v:!0}))}.bind(this)),this.sizeCapture=new S(a.win,a.getBindNS()+":resize",750,function(e,t){var i=this.rec,s=T.getViewportSizePos(i.win);this.lastSizes.lw===s.lw&&this.lastSizes.lh===s.lh||(this.worker.queueAction(M.FRAME_SIZE,{ctx:0,w:s.lw,h:s.lh,vw:s.vw,vh:s.vh}),this.lastSizes.lw=s.lw,this.lastSizes.lh=s.lh),this.lastSizes.pw===s.pw&&this.lastSizes.ph===s.ph||(this.worker.queueAction(M.DOC_SIZE,{ctx:0,w:s.pw,h:s.ph}),this.lastSizes.pw=s.pw,this.lastSizes.ph=s.ph),this._handleScroll(e,!0)}.bind(this))}for(this.rec.bind(a.win,"error",function(e){if(this.recordedErrors=(this.recordedErrors||0)+1,!(50<this.recordedErrors))if(e.message)this.worker.queueAction(M.JAVASCRIPT_ERROR,{ctx:this.ctx,v:e.message,l:e.lineno,cl:e.colno,s:e.source,st:e.error&&e.error.stack});else{var t=e.target;t&&this.worker.queueAction(M.ASSET_ERROR,{ctx:this.ctx,tg:this.tree.get(t).id,a:this.tree.get(t).a,ts:e.timeStamp})}}.bind(this)),e.isMobile||(f=e.isIE?a.win.document:a.win,this.mouseMoveCapture=s?new S(f,this.rec.getBindNS()+":mousemove",150,this._handleMouseEvents.bind(this)):this.recTop.cap.mouseMoveCapture.merge(f,this.rec.getBindNS()+":mousemove",this,!0),this.rec.bind(a.win.document,"mousedown",function(e){if(this.mouseMoveCapture){this.mouseMoveCapture.trigger();var t=this.tree.get(e.target),i=this.recTop.cap.lastMousePosition;i&&(this.worker.queueAction(M.MOUSE_DOWN,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id}),this.worker.emergency())}}.bind(this)),this.rec.bind(a.win.document,"mouseup",function(e){this.mouseMoveCapture.trigger();var t=this.tree.get(e.target),i=this.recTop.cap.lastMousePosition;i&&this.worker.queueAction(M.MOUSE_UP,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id})}.bind(this)),this.rec.bind(a.win.document,"click",function(e){this.mouseMoveCapture.trigger();var t=this.tree.get(e.target),i=this.recTop.cap.lastMousePosition;i&&this.worker.queueAction(M.MOUSE_CLICK,{ctx:0,x:Math.round(i.x),y:Math.round(i.y),id:t&&t.id})}.bind(this))),u=["start","end","cancel","leave","move"],p=0;p<u.length;p++)this.rec.bind(a.win.document,"touch"+u[p],function(t){return function(e){this._handleTouchEvents(e,t)}}(u[p]).bind(this),{passive:!0});if(s){var m=function(e){var t=this.rec,i=!1,s=T.getViewportSizePos(t.win);-90<=t.win.orientation&&t.win.orientation<=90&&(i=!0),this.worker.queueAction(M.ORIENTATION_CHANGE,{ctx:0,x:s.vx,y:s.vy,isL:i,lw:s.lw,lh:s.lh,pw:s.pw,ph:s.ph,vw:s.vw,vh:s.vh}),this.lastSizes.vw=s.vw,this.lastSizes.vh=s.vh,this.lastSizes.lw=s.lw,this.lastSizes.lh=s.lh}.bind(this);this.rec.bind(this.rec.win,"orientationchange",m)}s&&window.visualViewport&&(this.rec.bind(window.visualViewport,"resize",this._handleScroll.bind(this)),this.rec.bind(window.visualViewport,"scroll",this._handleScroll.bind(this))),this.rec.bind(n,"scroll",this._handleScroll.bind(this)),this.scanForIframes([n.document.body])};x.prototype._getHiddenKeys=function(){return void 0!==document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):void 0!==document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),{hidden:hidden,visibilityChange:visibilityChange}},x.prototype._serializeDom=function(){var e=this.fr.document,t=this.config,i=this.browser.browser,s=utils.getScreenResolution(),n=T.getViewportSizePos(this.fr),r=this.fr.location.href.toString(),o=utils.md5(r),a=this._getHiddenKeys(),c=!1;this.urlmd5=o,this.lastSizes=n,-90<=this.fr.orientation&&this.fr.orientation<=90&&(c=!0),this.worker.queueAction(M.PAGE_MARKER,{ctx:this.ctx,parent:this.rec.recordParent?this.rec.recordParent.instancePath:this.ctx,dt:T.getDocType(this.browser,e),doc:JSON.parse(JSON.stringify(this.tree.get(e.documentElement))),url:r,urlmd5:o,v:this.browser.agent,start:fs.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:utils.now()-fs.startTS,cid:t.clientId,f:document.referrer.toString(),t:this.fr.document.title,bn:i.name,bv:i.version,dw:s.w,dh:s.h,pw:n.pw,ph:n.ph,lw:n.lw,lh:n.lh,vw:n.vw,vh:n.vh,landscape:c,mobile:this.browser.isMobile,whiteListMode:this.masker.piiObj.useWhiteListing,sid:this.sessionInfo[f],gid:this.sessionInfo[g],vs:!document[a.hidden],scroll:{x:n.vx,y:n.vy}})},x.prototype._handleScroll=function(e,t){if(this.rec){var i,s,n,r=e.target,o={x:r.scrollLeft,y:r.scrollTop},a=this.rec.win,c=this.recTop;r===a.document||r===a.visualViewport||t?(n=T.getViewportSizePos(a),a!==a.top||this.lastSizes.vw===n.vw&&this.lastSizes.vh===n.vh||(this.worker.queueAction(M.ZOOM,{ctx:0,vw:n.vw,vh:n.vh,lw:n.lw,lh:n.lh}),this.lastSizes.vw=n.vw,this.lastSizes.vh=n.vh),this.lastSizes.vx===n.vx&&this.lastSizes.vy===n.vy||(this.worker.queueAction(M.FRAME_SCROLL,{ctx:this.rec.getPath(),x:n.vx,y:n.vy}),this.lastSizes.vx=n.vx,this.lastSizes.vy=n.vy),c.cap&&this.isMousedOverPage&&(i=c.cap._lastUnscrolledMouse,lastMouse=c.cap.lastMousePosition,i&&(s=utils.getScroll(c.win),i.x+s.x===lastMouse.x&&i.y+s.y===lastMouse.y||this.worker.queueAction(M.MOUSE_MOVE,{ctx:0,x:Math.round(i.x+s.x),y:Math.round(i.y+s.y)})))):this.worker.queueAction(M.SCROLL_EL,{ctx:this.rec.getPath(),id:this.tree.get(r).id,x:Math.round(o.x),y:Math.round(o.y)})}},x.prototype._handleTouchEvents=function(e,t){if(this.rec){var i,s,n,r=[];if(fs.isDefined(e.touches))for(i=0;i<e.touches.length;i++){s=e.touches[i],n=this.tree.get(s.target);var o=Math.round(s.pageX),a=Math.round(s.pageY);if(this.recTop!==this.rec){var c=this.rec.win.frameElement,h=T.getPositionRelativeToMainView(c,T.getParentWindow(c),!1),d=utils.getScroll(this.rec.win);h&&(o+=h.x-d.x,a+=h.y-d.y)}r.push({n:s.identifier,x:o,y:a,id:n&&n.id})}this.worker.queueAction(M.TOUCH,{ctx:0,ts:r,et:t}),("end"===t||1<r.length)&&this._handleScroll(e,!0),"end"===t&&this.worker.emergency()}},x.prototype._handleMouseEvents=function(e,t,i){if(this.isMousedOverPage&&e){var s={x:void 0!==e.clientX?e.clientX:void 0!==e.screenX?e.screenX:e.sX,y:void 0!==e.clientY?e.clientY:void 0!==e.screenY?e.screenY:e.sY},n=i?i.rec:this.rec;if(n){var r=utils.getScroll(n.win),o={x:r.x+s.x,y:r.y+s.y};if(this._lastUnscrolledMouse=s,i)if(i.isXDRIFrameMode)o.x+=n.ifrFrameOffset.x-r.x,o.y+=n.ifrFrameOffset.y-r.y;else{var a=n.win.frameElement,c=T.getPositionRelativeToMainView(a,T.getParentWindow(a),!1),h=utils.getScroll(this.recTop.win);c&&(o.x+=c.x-r.x,o.y+=c.y-r.y),this._lastUnscrolledMouse=fs.ext({},o),this._lastUnscrolledMouse.x-=h.x,this._lastUnscrolledMouse.y-=h.y}this.recTop.cap.lastMousePosition&&o.x===this.recTop.cap.lastMousePosition.x&&o.y===this.recTop.cap.lastMousePosition.y||(this.recTop.cap.lastMousePosition=o,this.worker.queueAction(M.MOUSE_MOVE,{ctx:0,x:Math.round(o.x),y:Math.round(o.y)}))}}},x.prototype.getFrameWindow=function(e){var t;return e&&e.contentWindow?t=e.contentWindow:e&&e.contentDocument&&e.contentDocument.defaultView&&(t=e.contentDocument.defaultView),t&&t!=t.top?t:null},x.prototype.testFrameOrigin=function(e,t){if(e.getAttribute("srcdoc")&&!e.getAttribute("src"))return!0;var i=e.getAttribute("src");if(!i)return!1;var s,n=["javascript:","about:blank"];for(s=0;s<n.length;s++)if(-1<i.indexOf(n[s]))return!1;if(!i||0===i.indexOf(" "))return!1;var r=e.src;return utils.testSameDomain(t||window.location.href,r)},x.prototype.bindToFrame=function(e,t){var i;t.__fsrec__=i=new A(this.rec.stg,this.rec.browser,t,this.tree.get(e).id,this.rec,this.rec.config,this.tree,this.rec.isIframeMode),this.rec.bind(t,"unload",function(){fs.nextTick(function(){i.dispose(),delete t.__fsrec__,this._framesBeingTracked.splice(this._framesBeingTracked.indexOf(e),1),this.scanForIframes([e.parentNode])}.bind(this))}.bind(this),!0)},x.prototype.scanForIframes=function(e){var t,i,s,n,r,o=this._framesBeingTracked;for(i=0;i<e.length;i++)if(0<(t=e[i].querySelectorAll("iframe")).length)for(r=Array.prototype.filter.call(t,function(e){return-1==o.indexOf(e)}),s=0;s<r.length;s++)o.push(r[s]),n=this.getFrameWindow(r[s]),this.testFrameOrigin(r[s])&&!n.__fsrec__&&("complete"===n.document.readyState||"interactive"===n.document.readyState?fs.nextTick(function(e,t){return function(){this.bindToFrame(e,t)}}(r[s],n).bind(this)):utils.BindOnce(n,this.rec.getBindNS()+":load",function(e,t){return function(){this.bindToFrame(e,t)}}(r[s],n).bind(this)))},x.prototype.dispose=function(){this.mutation.dispose(),this.mouseMoveCapture&&this.recTop===this.rec&&(this.mouseMoveCapture.dispose(),delete this.mouseMoveCapture),this.orientationCapture&&(this.orientationCapture.dispose(),delete this.orientationCapture),this.sizeCapture&&(this.sizeCapture.dispose(),delete this.sizeCapture),this.inputCap&&(this.inputCap.dispose(),delete this.inputCap);var e=this.tree.get(this.fr.document.documentElement);e&&(this.tree.remove(this.fr.document.documentElement),this.worker.queueAction(M.MOD_LIST,[{e:M.NODE_REMOVED,d:{ctx:this.ctx,id:e.id}}])),delete this.rec};var c={INIT:"INIT",DISPOSE:"DISPOSE",EVENTS:"EVENTS",WRAPUP:"WRAPUP"},O=function(e,t,i,s){fs.ext(this,{config:e,sesh:t,stg:i,fasttrackNextTransmit:!1,siteId:fs.toLowerCase(t.siteId.replace(/[^a-zA-Z0-9]*/g,"")),eventsBuffer:[],_lastTransmitTime:utils.now()-1e4,_lastEventTime:fs.startTS,isTransmitting:!1,_failedTransmits:0,_workerSendInterval:setInterval(this.transmitQueue.bind(this),2e3),_prevTimestamp:utils.now()},!1);var n=["("+function(s){var n=this;n.fs={ext:s.fsExt},n.utils={},n.utils.Zlib=s.zlib(),n.Compress=s.Compress;var r=function(){};r.handleMessage=function(e){if(e.data&&e.data.messageType)switch(e.data.messageType){case"INIT":var t=new(s.___domtree()),i=new(s.___treecensor())(t,s.pii);n.logger=new(s.___log())(n.fs,n.Compress,s.___diff(),t,i,s.EVENT_TYPES,r.handlePayloadReady.bind(r));break;case"DISPOSE":r.dispose();break;case"EVENTS":n.logger.addEvents(e.data.data);break;case"WRAPUP":n.logger.pinch()}},r._sendMessage=function(e,t){postMessage({messageType:e,data:t||{}})},r.handlePayloadReady=function(e){r._sendMessage("PAYLOAD",e)},r.dispose=function(){},n.onmessage=r.handleMessage}.toString()+")","({zlib: "+utils.__zlib.toString(),", Compress: "+this._funcObjToString(utils.Compress),", fsExt: "+fs.ext.toString(),", ___domtree: "+a.toString(),", ___log: "+function(){var e=function(fs,Compress,e,t,i,s,n){fs.ext(this,{Differ:e,Compress:Compress,tree:t,censor:i,log:[],types:s,payloadReady:n||function(){}},!1)};return e.prototype.checkChecksum=function(e,t,i){},e.prototype.addEvents=function(e){var i,s=this.tree,n=this.censor;e.forEach(function(e){if(e.d)if(e.e==this.types.PAGE_MARKER&&e.d.doc)i=s.import(e.d.doc),n.clean(i),n.censor(i),e.d.doc=JSON.parse(JSON.stringify(i));else if(e.e==this.types.MOD_LIST)e.d.forEach(function(e){switch(e.e){case this.types.ATTR_MODIFIED:(i=s.getById(e.d.id)).a=i.a||{},i.a[e.d.attr]=e.d.val,n.clean(i),e.d.val=i.a[e.d.attr];break;case this.types.CHAR_DATA:(i=s.getById(e.d.id)).v=e.d.v,n.censor(i),e.d.v=i.v;break;case this.types.NODE_REMOVED:s.removeById(e.d.id),this.checkChecksum("removing node",s,e.d.s);break;case this.types.NODE_ADDED:s.insert(e.d.idx,e.d.tree),n.clean(e.d.tree),n.censor(e.d.tree),e.d.tree=JSON.parse(JSON.stringify(e.d.tree)),this.checkChecksum("adding node",s,e.d.s);break;case this.types.NODE_MOVED:s.moveById(e.d.id,e.d.p,e.d.idx),n.clean(s.getById(e.d.id)),n.censor(s.getById(e.d.id)),this.checkChecksum("moving node",s,e.d.s)}}.bind(this));else if(e.e===this.types.KEY_PRESS){var t=this.Differ(e.d.v0,e.d.v1);i=s.getById(e.d.id),delete e.d.v0,delete e.d.v1,t&&(i.whitelist||(t.v=this.censor.maskString(t.v)),e.d.s=t.s,e.d.e=t.e,e.d.v=t.v)}else e.e===this.types.INPUT_SERIALIZE&&e.d.v&&((i=s.getById(e.d.id)).whitelist||(e.d.v=this.censor.maskString(e.d.v)))}.bind(this)),this.log=this.log.concat(e),1e4<this.log.length&&this.pinch()},e.prototype.pinch=function(){this.payloadReady(this.Compress.compress(JSON.stringify(this.log))),this.log=[]},e}.toString(),", ___diff: "+function(){return function(e,t){if("string"!=typeof e||0===e.length)return{s:0,v:t,e:0};if("string"!=typeof t||0===t.length)return{s:0,v:"",e:0};if(e===t)return null;var i,s,n,r={},o=Math.min(e.length,t.length);for(n=0;n<o;n++){if(e.charCodeAt(n)!==t.charCodeAt(n)){r.s=n;break}n===o-1&&(r.s=o)}for(o=e.length,i=t.length,s=Math.min(o-r.s,i-r.s),n=0;n<s;n++)if(e.charCodeAt(o-n-1)!==t.charCodeAt(i-n-1))return r.e=n,r.v=t.substr(r.s,i-n-r.s),r;return r.e=0,r.v=t.substr(r.s,i-r.s),r}}.toString(),", ___treecensor: "+function(){var t={alphabetL:"abcdefghijklmnopqrstuvwxyz",alphabetU:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",numbers:"0123456789"},e=function(e,t){this.tree=e,this.pii=t||{noRules:!0}};return e.prototype._removeAttr=function(e,t){e.a&&delete e.a[t]},e.prototype.clean=function(e){if("SCRIPT"==e.n&&(this._removeAttr(e,"src"),this._blankTreeText(e)),!e.a||"INPUT"!=e.n&&"TEXTAREA"!=e.n&&"SELECT"!=e.n||(1==e.a.fsrVisible?e.whitelist=!0:e.whitelist||(void 0!==e.v&&null!=e.v&&(e.v=this.maskString(e.v)),void 0!==e.a.value&&null!=e.a.value&&(e.a.value=this.maskString(e.a.value)),e.c&&0<e.c.length&&this._maskTree(e)),delete e.a.fsrVisible),e.a)for(var t in e.a)2<t.length&&"on"==t.substr(0,2)&&delete e.a[t];e.c&&0<e.c.length&&e.c.forEach(function(e){this.clean(e)}.bind(this))},e.prototype.maskString=function(e){return e.replace(/[^.,!?@#$%\(\)\\\/:\s-]/g,function(e){return-1<t.numbers.indexOf(e)?t.numbers.substr(Math.round(Math.random()*(t.numbers.length-1)),1):e==e.toUpperCase()?t.alphabetU.substr(Math.round(Math.random()*(t.alphabetU.length-1)),1):t.alphabetL.substr(Math.round(Math.random()*(t.alphabetL.length-1)),1)})},e.prototype._maskTree=function(e){e.unmasked||e.whitelist||"STYLE"===e.n||(void 0!==e.v&&null!=e.v&&(e.v=this.maskString(e.v)),e.c&&0<e.c.length&&e.c.forEach(function(e){this._maskTree(e)}.bind(this)))},e.prototype._blankTreeText=function(e){void 0!==e.v&&null!=e.v&&(e.v=""),e.c&&0<e.c.length&&e.c.forEach(function(e){this._blankTreeText(e)}.bind(this))},e.prototype._parentScan=function(e,t){for(;0<e.p;)if((e=this.tree.getById(e.p))[t])return!0},e.prototype.censor=function(e){var t=this.pii;t.useWhiteListing?t.noRules?this._maskTree(e):e.unmasked||this._parentScan(e,"unmasked")||this._maskTree(e):t.noRules||(e.masked||this._parentScan(e,"masked"))&&this._maskTree(e),e.c&&0<e.c.length&&e.c.forEach(function(e){this.censor(e)}.bind(this))},e}.toString(),", WORKER_MESSAGE_TYPES: "+JSON.stringify(c),", EVENT_TYPES: "+JSON.stringify(M),", pii: "+JSON.stringify(s&&s.piiObj),"})"],r=new Blob(n,{type:"application/javascript"}),o=window.URL.createObjectURL(r);this.wrkr=new Worker(o),this.wrkr.__zone_symbol__addEventListener?this.wrkr.__zone_symbol__addEventListener("message",this._handleMessage.bind(this),!0):this.wrkr.addEventListener("message",this._handleMessage.bind(this),!0),this._sendMessage(c.INIT,{}),t.beginTransmitting.subscribe(function(){this.isTransmitting=!0,this._transmit()}.bind(this),!0,!0)};O.prototype._actuallyTransmit=function(){this.fasttrackNextTransmit=!1,this._lastTransmitTime=utils.now();var t=this.sesh,e=this.sesh._storage,i=e.get("rpls")||[];0<i.length&&(new utils.AjaxTransport).send({method:"POST",contentType:"application/json",url:fs.config.recUrl+"rest/web/event/"+fs.enc(s.jrny.customerId)+"/"+fs.enc(t.sessionInfo[g])+"/"+fs.enc(t.sessionInfo[f])+"?domain="+fs.enc(document.domain)+"&site_id="+fs.enc(this.siteId)+"&version="+fs.enc("symlink"==fs.config.codeVer?"19.7.0":fs.config.codeVer),skipEncode:!0,data:{data:i},failure:function(e){this._failedTransmits++,20<this._failedTransmits&&t&&t.endSession()}.bind(this),success:function(t){(t=JSON.parse(t)).ids&&(i=e.get("rpls")||[],e.set("rpls",i.filter(function(e){return-1==t.ids.indexOf(e.when)})))}.bind(this)})},O.prototype._transmit=function(){if(this.isTransmitting&&!this._disposed){var e=utils.now()-this._lastTransmitTime;5e3<e||this.fasttrackNextTransmit?this._actuallyTransmit():(clearTimeout(this._transmitTimer),this._transmitTimer=setTimeout(this._actuallyTransmit.bind(this),5e3-e))}},O.prototype._funcObjToString=function(e){var t,i="{";for(t in e)i+='"'+t+'":'+(fs.isObject(e[t])&&null!=e[t]?this._funcObjToString(e[t]):fs.isFunction(e[t])?e[t].toString().replace(/\[native code\]/g,""):JSON.stringify(e[t]))+",";return i+"}"},O.prototype._handleMessage=function(e){if(e.data&&e.data.messageType&&e.data.data&&!this._disposed){var t=e.data;switch(t.messageType){case"PAYLOAD":var i=this.sesh._storage,s=i.get("rpls")||[];s.push({when:this._getMonotonicTimestamp(),data:t.data}),i.set("rpls",s),i.commit(),this._transmit()}}},O.prototype._getMonotonicTimestamp=function(){var e=utils.now();return e<=this._prevTimestamp&&(e=this._prevTimestamp+1),this._prevTimestamp=e},O.prototype._sendMessage=function(e,t){this.wrkr.postMessage({messageType:e,data:t||{}})},O.prototype.transmitQueue=function(){0<this.eventsBuffer.length&&!this._disposed&&(this._sendMessage(c.EVENTS,this.eventsBuffer),this.eventsBuffer=[])},O.prototype.emergency=function(){!this._disposed&&this.wrkr&&(this.transmitQueue(),this.wrkr.postMessage({messageType:c.WRAPUP}),this.fasttrackNextTransmit=!0)},O.prototype.queueAction=function(e,t,i){return i=i||utils.now(),this.eventsBuffer.push({e:e,td:i-this._lastEventTime,d:t}),this._lastEventTime=i},O.prototype.dispose=function(){this._disposed=!0,clearInterval(this._workerSendInterval),clearTimeout(this._transmitTimer),this.transmitQueue(),this._sendMessage(c.DISPOSE),this.wrkr.terminate(),delete this.sesh,delete this.wrkr,delete this.config};var M={DOM_SERIALIZE:0,FRAME_SIZE:2,FRAME_SCROLL:3,MOUSE_MOVE:4,WINDOW_MOUSEOUT_MOUSEENTER:5,INPUT_SERIALIZE:6,FOCUS_BLUR:7,KEY_PRESS:8,CARET_INFO:9,ATTR_MODIFIED:12,JAVASCRIPT_ERROR:13,MOUSE_CLICK:14,MOUSE_DOWN:15,MOUSE_UP:16,PAGE_MARKER:17,DOC_SIZE:18,SCROLL_EL:19,NOT_RECORDED:20,CSS_SERIALIZE:21,ORIENTATION:22,ZOOM:23,TOUCH:24,ORIENTATION_CHANGE:26,CUSTOM_BEHAVIOR:27,CUSTOM_ERROR:28,HEARTBEAT:29,NODE_ADDED:30,NODE_REMOVED:31,PAGE_VISIBLE:32,INPUT_RESIZE:33,CHAR_DATA:34,MOD_LIST:37,NODE_MOVED:38,PAGE_ERROR:40,ASSET_ERROR:41,MASKING_CHANGE:42},C=function(e,t){fs.ext(this,{config:t,stg:e,beginTransmitting:new utils.FSEvent,endSessionEvent:new utils.FSEvent,siteId:t.clientId||"unk"},!1);var i=e.get([g,p,m,"pv",_]),s=i[g],n=i[p]||!1,r=utils.now();if(!0!==i[_]){s||(s=this._generateSID());var o=this._backup_storage=new utils.DomStorage(this.siteId,!1,!1),a=this._storage=new utils.WindowStorage(this.siteId);if(a.isNew()&&!o.isNew())a.set(v,o.get(v)),a.setBlob(o.getBlob());else if(!a.isNew()&&o.isNew()){var c=a.get(v);c&&(s=c[g]),a.setBlob(a.getBlob())}var h=a.get(v),d=!1;("m"!==s[0]||h&&"m"!==h[f][0])&&(d=!0);var l=parseInt(e.get(y));isNaN(l)&&!d||(36e5<r-l||d)&&(s=this._generateSID(),h=null,n=!1,a.erase(v),e.erase(g),fs.supportsDomStorage&&(localStorage.removeItem(p),localStorage.removeItem(_))),h?n=h[p]:(n=!(h={}),h[f]=this._generateSID(),h[g]=s,h[p]=n),e.set(p,n),e.set(g,s),e.set(y,r),a.set(v,h),this.sessionInfo=h,a.commit(),o&&utils.Bind(window,"beforeunload",function(){o.set(v,a.get(v)),o.commit()}.bind(this)),n?this.beginTransmitting.fire():this._stateCheckInterval=setInterval(this._checkTransmittingState.bind(this),5e3)}else this.DONOTRECORD=!0};C.prototype._generateSID=function(){return"m"+utils.generateGUID().substr(1)},C.prototype._checkTransmittingState=function(){var e=!1;fs.supportsDomStorage&&(e="yes"==localStorage.getItem(p),localStorage.getItem(_)),e||(e=this.isTransmitting()),e&&(clearInterval(this._stateCheckInterval),this.beginTransmitting.fire())},C.prototype.isTransmitting=function(){return!!this.sessionInfo[p]},C.prototype.setTransmitting=function(){fs.supportsDomStorage&&localStorage.setItem(p,"yes"),clearInterval(this._stateCheckInterval),this.stg.set(p,!0),this.sessionInfo[p]=!0,this._storage.set(v,this.sessionInfo),this._storage.commit(),this.beginTransmitting.fire()},C.prototype.clear=function(){var e=this.stg;clearInterval(this._stateCheckInterval),e.erase(p),e.erase(g),e.erase(y),fs.supportsDomStorage&&(localStorage.removeItem(p),localStorage.removeItem(_)),this._storage.eraseAll(),this._backup_storage.eraseAll()},C.prototype.endSession=function(){this.clear(),this.stg.set(_,!0,36e5),this.DONOTRECORD=!0,fs.supportsDomStorage&&localStorage.setItem(_,"yes"),this.endSessionEvent.fire()},C.prototype.getGlobalId=function(){return this.sessionInfo[g]},C.prototype.getSessionId=function(){return this.sessionInfo[f]},C.prototype.dispose=function(){clearInterval(this._stateCheckInterval)};var A=function(e,t,i,s,n,r,o,a,c,h,d,l,u){if(fs.ext(this,{browser:t,config:r,stg:e,win:i,ready:new utils.FSEvent,isIframeMode:!!a,recordParent:n,instancePath:s,iFrameParentFr:h,ifrid:c,skipPage:u},!1),this.win.document){if(this.sesh=n&&n.sesh?n.sesh:new C(e,r),this.sesh.DONOTRECORD)return;if(this.sesh.endSessionEvent.subscribe(this.dispose.bind(this)),u||(this.masker=new k(r.advancedSettings.pii,this.win),this.masker.updateMaskingTargets()),this.worker=n&&n.worker?n.worker:new O(r,this.sesh,e,this.masker),u){var p=this.win.location.href.toString();this.worker.queueAction(M.PAGE_MARKER,{ctx:this.getPath(),parent:this.recordParent?this.recordParent.instancePath:0,dt:null,doc:null,url:p,urlmd5:utils.md5(p),v:this.browser.agent,start:fs.startTS,tz:(new Date).getTimezoneOffset(),domloadtime:utils.now()-fs.startTS,cid:r.clientId,f:document.referrer.toString(),t:document.title,bn:br.name,bv:br.version,dw:0,dh:0,pw:0,ph:0,lw:0,lh:0,vw:0,vh:0,landscape:null,mobile:this.browser.isMobile,whiteListMode:null,sid:this.sessionInfo[f],gid:this.sessionInfo[g],vs:!0,scroll:{x:0,y:0}}),fs.nextTick(function(){this.worker.queueAction(M.NOT_RECORDED,{ctx:this.getPath()}),this.worker.emergency()}.bind(this))}else this.cap=new x(t,this.config,this.isIframeMode,this.getTop()===this,i,this.masker,this.worker,this,s,this.urlmd5,o,this.sesh.sessionInfo);this.ready.fire()}!n&&t.isMobile&&this.setTransmitOK()};A.prototype.getTop=function(){return this.recordParent?this.recordParent.getTop():this},A.prototype.getPath=function(){return this.instancePath},A.prototype.getBindNS=function(){return"record"+this.getPath()},A.prototype.bind=function(e,t,i,s){utils.Bind(e,this.getBindNS()+":"+t,i,s)},A.prototype.setTransmitOK=function(){this.sesh.setTransmitting()},A.prototype.clearState=function(){this.sesh.clear(),this.dispose()},A.prototype.getGlobalId=function(){return this.sesh.getGlobalId()},A.prototype.getSessionId=function(){return this.sesh.getSessionId()},A.prototype.getPIIConfig=function(){return this.masker&&this.masker.piiObj},A.prototype.getMaskingTargets=function(){return this.masker&&this.masker.getCurrentMaskingTargets()},A.prototype.processImmediately=function(e){(new utils.AjaxTransport).send({method:"GET",url:utils.sign(fs.config.recUrl+"process/"+fs.enc(this.getGlobalId())+"?version="+fs.enc("symlink"==fs.config.codeVer?"19.7.0":fs.config.codeVer)+"&delay="+(e||0)),failure:function(e){}.bind(this),success:function(e){}.bind(this)})};A.prototype.sendCustomEvent=function(e,t,i,s){i=i||t,s=JSON.stringify(s||{}),256<i.length&&(i=i.substr(0,256)),1e4<s.length&&(s=JSON.stringify({msg:"Meta object too large"})),this.worker.queueAction(e,{msg:i,meta:s})},A.prototype.dispose=function(){return!this.disposed&&(this.disposed=!0,this.masker&&this.masker.dispose(),this.ready.unsubscribeAll(),this.getTop()===this&&(this.worker.dispose(),this.sesh.dispose()),this.cap&&this.cap.dispose(),utils.Unbind(this.getBindNS()+":*"),!0)};var N=function(e,t){this.config=e,this.browser=t,this.didSkipOnPurpose=!1,this.reasons={}};N.prototype.supported=function(){var e,o,a,t=this.config.advancedSettings||{},i=this.browser,s=this.config.blacklist,n=this.config.whitelist,r=!1,c=t.device_type_support,h=location.toString();t.browser_cutoff||(t.browser_cutoff={}),t.platform_cutoff||(t.platform_cutoff={}),t.browser_cutoff.IE=Math.max(t.browser_cutoff.IE,11),t.browser_cutoff.Safari=Math.max(t.browser_cutoff.Safari,8),t.browser_cutoff.Chrome=Math.max(t.browser_cutoff.Chrome,38),t.browser_cutoff["Chrome Mobile"]=Math.max(t.browser_cutoff["Chrome Mobile"],38),t.platform_cutoff.Android=Math.max(t.platform_cutoff.Android,5),["iPod","iPhone","iPad"].forEach(function(e){t.platform_cutoff[e]=Math.max(t.platform_cutoff[e],8)});var d=function(e,t,i){var s=i[t];switch(t){case"urls":case"text":for(o=0;o<s.length;o++){if(utils.testAgainstSearch(s[o],h))return this.reasons[e+"_"+t+"_"+o]=!0;this.reasons[e+"_"+t+"_"+o]=!1}break;case"variables":for(o=0;o<s.length;o++)if(fs.isDefined(s[o].name)){if(a=utils.retrieveNestedVariable(l,s[o].name),s[o].value===a)return this.reasons[e+"_"+t+"_"+s[o].name]=!0;if(!0===a&&"true"==s[o].value)return this.reasons[e+"_"+t+"_"+s[o].name]=!0;if(!1===a&&"false"==s[o].value)return this.reasons[e+"_"+t+"_"+s[o].name]=!0;this.reasons[e+"_"+t+"_"+s[o].name]=!1}break;case"cookies":var n,r=new utils.Cookie;for(o=0;o<s.length;o++){if(n=r.get(s[o].name),fs.isDefined(n)&&n==s[o].value)return this.reasons[e+"_"+t+"_"+s[o].name]=!0;this.reasons[e+"_"+t+"_"+s[o].name]=!1}}return this.reasons[e+"_"+t]=!1}.bind(this);if(t.browser_cutoff[i.browser.name]&&i.browser.actualVersion<t.browser_cutoff[i.browser.name])return!(this.reasons.browserUnsupported=!0);if(this.reasons.browserUnsupported=!1,t.platform_cutoff[i.os.name]&&i.os.version<t.platform_cutoff[i.os.name])return!(this.reasons.platformUnsupported=!0);if(this.reasons.platformUnsupported=!1,c&&(!c.desktop&&!i.isMobile||!c.tablet&&i.isTablet||!c.phone&&i.isMobile&&!i.isTablet))return!(this.reasons.deviceTypeUnsupported=!0);if(this.reasons.deviceTypeUnsupported=!1,s)for(e in s)if(d("blacklist",e,s))return this.didSkipOnPurpose=!0,!(this.reasons.blacklistMatched=!0);if(this.reasons.blacklistMatched=!1,n){for(e in n)if(d("whitelist",e,n)){r=!0;break}if(!r)return this.didSkipOnPurpose=!0,!(this.reasons.whitelistNotMatched=!0)}for(this.reasons.whitelistNotMatched=!1,e=0;e<t.device_blacklist.length;e++)if(-1<fs.toLowerCase(i.agent).indexOf(t.device_blacklist[e].toLowerCase()))return!(this.reasons.deviceBlacklisted=!0);return!(this.reasons.deviceBlacklisted=!1)};var R={};R._apiReady=new utils.FSEvent,fs.API.expose("beginTransmitting",function(){R._apiReady.subscribe(function(){R._controller.beginTransmitting()},!0,!0)}),fs.API.expose("cancelRecord",function(){R._apiReady.subscribe(function(){R._controller.cancelRecord()},!0,!0)}),fs.API.expose("getSession",function(i){i=i||console.table||console.log,R._apiReady.subscribe(function(){var e=R._controller.getGlobalId(),t=R._controller.getSessionId();i({gsessionid:e,sessionid:t,sig:e+"/"+t})},!0,!0)}),fs.API.expose("Record",{getConfig:function(e){e=e||console.log,R._apiReady.subscribe(function(){e(JSON.parse(JSON.stringify(h)))},!0,!0)},process:function(){R._apiReady.subscribe(function(){R._controller.recorder&&(R._controller.recorder.worker&&R._controller.recorder.worker.emergency(),setTimeout(function(){R._controller.recorder.processImmediately(0)},500))},!0,!0)},getPIIConfig:function(e){e=e||console.table||console.log,R._apiReady.subscribe(function(){R._controller.recorder&&e(JSON.parse(JSON.stringify(R._controller.recorder.getPIIConfig())))},!0,!0)},getPIIElements:function(t){t=t||console.log,R._apiReady.subscribe(function(){if(R._controller.recorder){var e=R._controller.recorder.getMaskingTargets()||{};t({selectiveUnMaskZones:e.unmasked,selectiveMaskZones:e.masked,visibleInputs:e.whitelist,redactZones:e.redact})}},!0,!0)},diagnoseCriteria:function(e){e=e||console.table||console.log,R._apiReady.subscribe(function(){R._controller.crit&&e(R._controller.crit.reasons)},!0,!0)},error:function(e,t){R._apiReady.subscribe(function(){R._controller.sendCustomEvent(M.CUSTOM_ERROR,"ERROR",e,t)},!0,!0)},event:function(e,t){R._apiReady.subscribe(function(){R._controller.sendCustomEvent(M.CUSTOM_BEHAVIOR,"EVENT",e,t)},!0,!0)}}),R.ready=function(e){R._controller=e,R._apiReady.fire()};var r=null;function o(){var e=arguments[2];this.jrny=s.jrny=new utils.Journey(fs.config.customerId||utils.getRootDomain()||"record_customerId",utils.APPID.REPLAY,e,arguments[0]),this.jrny.addEventsDefault("properties",{fs_pageViews:[e.get("pv")]}),this.initialize.apply(this,arguments)}return o.prototype.isIframe=function(){return window!=window.top},o.prototype.isCrossDomainFrame=function(){if(this.isIframe())try{return window.top.document.body.toString().length.length<0}catch(e){return!0}return!1},o.prototype.initialize=function(s,n,r,e,o){if("undefined"!=typeof Uint8Array){var t=this.isIframe(),a=this.isCrossDomainFrame();if(!t||a){if(e&&fs.ext(h.advancedSettings||{},e),this.winobj=n,this.browser=s,h&&h.instances)for(var i=0;i<h.instances.length;i++){var c=h.instances[i];if(!c.disabled){fs.ext(h,c);break}}this.crit=new N(h,s),(this.stg=r).ready.subscribe(function(){s.ready.subscribe(function(){if(this.crit.supported()||this.crit.didSkipOnPurpose){var i=this.stg.get(["rt","i","pv"]);a?utils.Bind(window,"message",function(e){if(e.data=e.data+"",e.data&&fs.isFunction(e.data.indexOf)&&3<e.data.length&&-1<e.data.indexOf("{")){var t;try{t=JSON.parse(e.data)}catch(e){return}t.src&&"fsframe"==t.src||(t.cxr&&t.id?(this.recorder=new A(r,s,n,t.xp,null,h,null,a,t.id,e.source,t.sid,t.sp),this.recorder.ready.subscribe(function(){o.set("replay_id",this.recorder.sesh.sessionInfo[g]),o.set("sessionid",this.recorder.sesh.sessionInfo[f]),R.ready(this)}.bind(this),!0,!0),i.rt||"x"!==i.i||this.beginTransmitting(),utils.Bind(window,"unload",function(){if(this.recorder){var e=this.recorder.ifrid;window.top.postMessage({unloadiFrame:!0,frameId:e},"*"),this.recorder.dispose(),delete this.recorder}}.bind(this))):t.cxsp&&this.recorder&&this.recorder.setXFrameScrollPosition(t.sp))}}.bind(this)):(this.recorder=new A(r,s,n,0,null,h,null,a,null,null,null,null,!!this.crit.didSkipOnPurpose),this.recorder.ready.subscribe(function(){o.set("replay_id",this.recorder.sesh.sessionInfo[g]),o.set("sessionid",this.recorder.sesh.sessionInfo[f]),R.ready(this)}.bind(this),!0,!0),this.jrny&&1===i.pv&&this.jrny.addEventString(d),i.rt||"x"!==i.i||this.beginTransmitting(),utils.Bind(window,"beforeunload",function(){this.recorder&&(this.recorder.dispose(),delete this.recorder)}.bind(this)))}else R.ready(this)}.bind(this),!0,!0)}.bind(this),!0,!0)}}else this.jrny&&this.jrny.addEventString(u)},o.prototype.beginTransmitting=function(){this.recorder&&this.recorder.setTransmitOK()},o.prototype.dispose=function(){this.recorder&&(this.recorder.dispose(),delete this.recorder,r=null)},o.prototype.cancelRecord=function(){this.recorder&&(this.recorder.dispose(),delete this.recorder),this.jrny&&this.jrny.addEventString(t)},o.prototype.getGlobalId=function(){return this.recorder&&this.recorder.getGlobalId()},o.prototype.getSessionId=function(){return this.recorder&&this.recorder.getSessionId()},o.prototype.sendCustomEvent=function(e,t,i,s){return this.recorder&&this.recorder.sendCustomEvent(e,t,i,s)},o.getInstance=function(e,t,i,s,n){return null===r&&(r=new o(e,t,i,s,n)),r},o.disposeInstance=function(){r&&(r.dispose(),r=null)},o});